@using System.Data
@{
    ViewBag.Title = "Follow-Ups Summary - ACT II";
    ViewBag.TitleIcon = "fa fa-user";
    ViewBag.SemiTitle = "Follow-Ups Summary - ACT II";
    ViewBag.SemiTitleLink = "/";
    DateTime now = DateTime.Now;
    var startDate = new DateTime(now.Year, now.Month, 1);
    var endDate = startDate.AddMonths(1).AddDays(-1);
    //DataSet ds = new DataSet();
    //DataTable dt = new DataTable();
    //DataTable dt1 = new DataTable();
    //DataTable dt2 = new DataTable();
    //DataTable dt3 = new DataTable();
    //int TotalFollowUp = 0, TotalSuspectedVisitBP = 0, TotalSuspectedVisitBS = 0, TotalSuspectedVisitCOMorb = 0;
    //if (Model != null)
    //{
    //    ds = Model;
    //    if (ds.Tables.Count > 0)
    //    {
    //        if (ds.Tables[0].Rows.Count > 0)
    //        {
    //            dt = ds.Tables[0];
    //            TotalFollowUp = Convert.ToInt32(dt.Rows[0][0]);
    //            TotalSuspectedVisitBP = Convert.ToInt32(dt.Rows[0][1]);
    //            TotalSuspectedVisitBS = Convert.ToInt32(dt.Rows[0][2]);
    //            TotalSuspectedVisitCOMorb = Convert.ToInt32(dt.Rows[0][3]);
    //        }
    //        if (ds.Tables[1].Rows.Count > 0)
    //        {
    //            dt1 = ds.Tables[1];

    //        }
    //        if (ds.Tables[2].Rows.Count > 0)
    //        {
    //            dt2 = ds.Tables[2];
    //        }
    //        if (ds.Tables[3].Rows.Count > 0)
    //        {
    //            dt3 = ds.Tables[3];
    //        }
    //    }
    //}
}
<style>
    table {
        text-indent: 0;
        border-color: inherit;
        border-collapse: separate !important;
    }

    .SizeFn {
        font-size: 13px !important;
    }

    h6, .h6 {
        font-size: 0.900rem !important;
    }

    .charts {
        border: 2px solid #1d2d5b !important;
    }

    .row > * {
        flex-shrink: 0;
        width: 100%;
        max-width: 100%;
        padding-right: calc(var(--bs-gutter-x)* .2) !important;
        padding-left: calc(var(--bs-gutter-x)* .2) !important;
    }
</style>
<style>
    .loading {
        position: fixed;
        top: 0;
        z-index: 900;
        width: 100%;
        height: 100%;
        display: none;
        background: rgba(0,0,0,0.6);
    }

    .cv-spinner {
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px #ddd solid;
        border-top: 4px #2e93e6 solid;
        border-radius: 50%;
        animation: sp-anime 0.8s infinite linear;
    }

    @@keyframes sp-anime {
        100% {
            transform: rotate(360deg);
        }
    }

    .is-hide {
        display: none;
    }

    .fw {
        font-weight: 200 !important;
        font-size: 12px !important;
    }

    .sp {
        font-weight: 700 !important;
    }
    .highcharts-legend-item {
        display: none !important;
    }
</style>
<div id="spinner" class="loading" hidden>
    <div class="cv-spinner">
        <span class="spinner"></span>
    </div>
    @*<img src="~/Content/assets/images/Loading_2.gif" alt="Loading" />*@
</div>
<div class="content-body">
    <div class="container-fluid">
        <!-- Row -->
        <div class="page-titles dark:bg-[#1b1b1b] rounded-ss-md flex items-center justify-between relative  mb-[1.875rem] flex-wrap z-[1] py-[0.9375rem] sm:px-[0.975rem] px-[1.875rem] bg-white">
            <h4>@ViewBag.Title</h4>
            @*@Html.ActionLink("Raw Data Download", "FollowUpSuspectedSummaryRawDataDownload", "Home", new object { },
                new { @id = "btnallRaw", @class = "mr-1 mb-2 inline-block rounded-lg font-medium xl:text-[10px] text-xs leading-5 xl:py-[0.719rem] xl:px-[1.563rem] py-2.5 px-4 border border-primary text-white bg-primary hover:bg-hover-primary hover:border-hover-primary duration-300" })*@
            @*<a href="javascript:void(0);" id="downloadbtnrawall" class="mr-1 mb-2 inline-block rounded-lg font-medium xl:text-[10px] text-xs leading-5 xl:py-[0.719rem] xl:px-[1.563rem] py-2.5 px-4 border border-primary text-white bg-primary hover:bg-hover-primary hover:border-hover-primary duration-300">Raw Data Download</a>*@
        </div>
        <div class="row">
            <div class="filter cm-content-box box-primary relative rounded-lg mb-4 bg-white dark:bg-[#1b1b1b]">
                @*<div class="content-title flex justify-between items-center py-4 sm:px-6 px-[1.2rem] card-toggle-btn">
                        <div class="cpa text-dark dark:text-white text-base font-semibold">
                            <i class="fa-sharp fa-solid fa-filter mr-2"></i>Filter
                        </div>
                        <div class="tools">
                            <a href="javascript:void(0);" class="expand SlideToolHeader inline-block"><i class="fal fa-angle-down font-['Font_Awesome_6_Free'] font-semibold text-[#c2c2c2] text-xl arrow"></i></a>
                        </div>
                    </div>*@


                <div class="content form excerpt border-t border-b-color dark:border-[#ffffff1a]">
                    <div class="p-[1.0rem] max-sm:p-4">

                        <section class="accordion">
                            <div class="tab">
                                <input type="checkbox" name="accordionfilter-1" id="cbfilter1">
                                <label for="cbfilter1" class="tab__label"><strong>Filter</strong> </label>
                                <div class="tab__content">
                                    <div class="border-all">

                                        <div class="mb-4 md:w-1/2">
                                            <label class="form-label">Block</label>
                                            @Html.DropDownList("BlockId", new List<SelectListItem>(), "All", new { @class = "form-control relative text-[13px] text-body-color h-[2.813rem] border border-b-color block rounded-lg py-1.5 px-3 duration-500  outline-none w-full ", @required = "required" })
                                        </div>
                                        <div class="mb-4 md:w-1/2" style="display:none;">
                                            <label class="form-label">Patient</label>
                                            @Html.DropDownList("TypeOfPatient", NCDNewMIS.Models.CommonModel.GetTypeofPatient(), null, new { @class = "form-control relative text-[13px] text-body-color h-[2.813rem] border border-b-color block rounded-lg py-1.5 px-3 duration-500  outline-none w-full ", @required = "required" })
                                        </div>
                                        <div class="mb-4 md:w-1/1">
                                            <label class="form-label">Gender</label>
                                            @Html.DropDownList("GenderId", NCDNewMIS.Models.CommonModel.GetGender(), null, new { @class = "form-control relative text-[13px] text-body-color h-[2.813rem] border border-b-color block rounded-lg py-1.5 px-3 duration-500  outline-none w-full ", @required = "required" })
                                        </div>

                                        <div class="mb-4 md:w-1/1">
                                            <label class="form-label">Age</label>
                                            @Html.DropDownList("Ageyrs", NCDNewMIS.Models.CommonModel.GetAgeYrs(), null, new { @class = "form-control relative text-[13px] text-body-color h-[2.813rem] border border-b-color block rounded-lg py-1.5 px-3 duration-500  outline-none w-full ", @required = "required" })
                                        </div>
                                        <div class="mb-4 md:w-1/2">
                                            <div class="title"></div>
                                            <div class="tools">
                                                <div id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px; width: 100%">
                                                    <i class="fa fa-calendar"></i>&nbsp;
                                                    <span>January 1, 2024 - December 31, 2024</span> <i class="fa fa-caret-down"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="sm:w-1/2 mt-6">
                                            <button name="btnsubmit" id="btnsubmit"
                                                    class="mr-1 mb-2 inline-block rounded-lg font-medium xl:text-[12px] text-xs leading-5 xl:py-[0.719rem] xl:px-[1.563rem] py-2.5 px-4 border border-primary text-white bg-primary hover:bg-hover-primary hover:border-hover-primary duration-300">
                                                Search
                                            </button>
                                            <a href="~/Home/FollowSuspSummaryData" class="mr-1 mb-2 inline-block rounded-lg font-medium xl:text-[12px] text-xs leading-5 xl:py-[0.719rem] xl:px-[1.563rem] py-2.5 px-4 border border-warning bg-warning text-white hover:bg-[#ffa91a] duration-300"><i class="fa fa-refresh"></i></a>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>

            </div>
        </div>

        <div class="w-full">

            <div class="row">
                <section class="accordion">
                    <div class="tab">
                        <input type="checkbox" name="accordion-1" id="cb1">
                        <label for="cb1" class="tab__label"><strong>Total Screening</strong> </label>
                        <div class="tab__content">
                            <div class="bg-white dark:bg-[#1b1b1b]" style="padding:20px">
                                <h5 class="text-left">
                                    <strong class="fw">Total number of Screening : <span class="sp" id="TotalNooofScreening"></span> </strong><br />
                                    <strong class="fw">Total number of Hypertension suspect : <span class="sp" id="TotalNoofSuspectBPYes"></span> </strong><br />
                                    <strong class="fw">Total number of Diabetic suspect : <span class="sp" id="TotalNoofSuspectBSYes"></span> </strong><br />
                                    <strong class="fw">Comorbidity : <span class="sp" id="ComBothTotalNoofSuspectBPBS"></span> </strong>
                                </h5>
                            </div>

                        </div>
                    </div>
                    <div class="tab">
                        <input type="checkbox" name="accordion-1" id="cb2">
                        <label for="cb2" class="tab__label"><strong>Followup Visit For Hypertension &amp; Diabetic Suspect</strong></label>
                        <div class="tab__content">
                            <div class="row">

                                <div class="xl:w-1/2 w-full ">
                                    <div class="bg-white dark:bg-[#1b1b1b]" style="padding:20px">
                                        <h5 class="text-center"><strong>For Hypertension suspect</strong> </h5>
                                        <h5 class="text-left">
                                            <strong class="fw">Total No. of suspects available for followup : <b class="sp" id="TotalnooffupNCDMitraYesBP"></b> </strong><br />
                                            <strong class="fw">Total No. of suspects remaining for followup : <b class="sp" id="NotfupNoofMembersBPYes"></b> </strong><br />
                                            <strong class="fw">Total No. of suspects Who visited health facility after followup : <b class="sp" id="TotalnooffupNCDMitraYesNoBP"></b> </strong><br />
                                            <strong class="fw">Total No. of suspects Who did not visited health facility even after 3 times of followup : <b class="sp" id="TotalNotnooffupNCDMitraYesNotBP"></b> </strong>
                                        </h5>
                                    </div>
                                </div>

                                <div class="xl:w-1/2 w-full">
                                    <div class="bg-white dark:bg-[#1b1b1b]" style="padding:20px">
                                        <h5 class="text-center"><strong>For Diabetic suspect</strong> </h5>
                                        <h5 class="text-left">
                                            <strong class="fw">Total No. of suspects available for followup : <b class="sp" id="TotalnoofNCDMitraYesBS"></b> </strong><br />
                                            <strong class="fw">Total No. of suspects remaining for followup : <b class="sp" id="NotfupNotNoofMembersBSYes"></b> </strong><br />
                                            <strong class="fw">Total No. of suspects Who visited health facility after followup : <b class="sp" id="TotalnoofNCDMitraBS"></b> </strong><br />
                                            <strong class="fw">Total No. of suspects Who did not visited health facility even after 3 times of followup : <b class="sp" id="TotalNotnoofNCDMitraYesNoBS"></b> </strong>
                                        </h5>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </section>

            </div>
            <br />

            <div class="row">

                <div class="xl:w-1/3 w-full " style="padding-bottom:5px;">
                    <div class="xl:w-1/1 w-full ">
                        <div class="bg-white dark:bg-[#1b1b1b] SizeFn" style="padding:5px;">
                            <h6 class="text-center">
                                <strong class="text-primary">Details Of Follow-Ups: Hypertensive Suspects</strong>
                            </h6>
                            <div class="overflow-x-auto table-scroll SizeFn" style="">
                                <div>Number of suspects followed-up : <strong id="TotalFollowupHP"></strong></div>
                                <div>Number of suspects visited Health Facility : <strong id="TotalSuspectedVisitHP"></strong> &nbsp; || <strong id="TotalFollowupHPPercentage"></strong> (%) </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="xl:w-1/3 w-full " style="padding-bottom: 5px;">
                    <div class="xl:w-1/1 w-full ">
                        <div class="bg-white dark:bg-[#1b1b1b] SizeFn" style="padding:5px">
                            <h6 class="text-center">
                                <strong class="text-primary">Detail of follow-ups: Diabetic suspects</strong>
                            </h6>
                            <div class="overflow-x-auto table-scroll SizeFn">
                                <div>Number of suspects followed-up : <strong id="TotalFollowupBS"></strong></div>
                                <div>Number of suspects visited Health Facility :  <strong id="TotalSuspectedVisitBS" style="padding-left:1%;"></strong> &nbsp; || <strong id="TotalFollowupBSPercentage"></strong> (%) </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="xl:w-1/3 w-full " style="padding-bottom: 5px;">
                    <div class="xl:w-1/1 w-full ">
                        <div class="bg-white dark:bg-[#1b1b1b] SizeFn" style="padding:5px">
                            <h5 class="text-center">
                                <strong class="text-primary">Detail of follow-ups: Comorbidity</strong>
                            </h5>
                            <div class="overflow-x-auto table-scroll">
                                <div>Number of suspects followed-up : <strong id="TotalFollowupCOM"></strong></div>
                                <div>Number of suspects visited Health Facility :  <strong id="TotalSuspectedVisitCOMorb"></strong> &nbsp; || <strong id="TotalFollowupCOMPercentage"></strong> (%) </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="xl:w-1/2 w-full ">
                    <div class="xl:w-1/1 w-full charts">
                        <div class="bg-white dark:bg-[#1b1b1b]" style="padding:5px">

                            <div class="overflow-x-auto table-scroll">
                                <div id="HYPlaceVisitBPBar"></div>
                                <p id="p-bpbar"></p>
                            </div>

                        </div>
                    </div>
                    <br />
                    <div class="xl:w-1/1 w-full charts">
                        <div class="bg-white dark:bg-[#1b1b1b]" style="padding:5px">

                            <div class="overflow-x-auto table-scroll">
                                <div id="HYCheckBPPie"></div>
                              
                            </div>

                        </div>
                    </div>
                    <br />
                    <div class="xl:w-1/1 w-full charts">
                        <div class="bg-white dark:bg-[#1b1b1b]" style="padding:5px">

                            <div class="overflow-x-auto table-scroll">
                                <div id="HYMedicationBPPie"></div>
                            </div>

                        </div>
                    </div>
                </div>
                <br />
                <div class="xl:w-1/2 w-full ">
                    <div class="xl:w-1/1 w-full charts">
                        <div class="bg-white dark:bg-[#1b1b1b]" style="padding:5px">

                            <div class="overflow-x-auto table-scroll">
                                <div id="HYPlaceVisitBSBar"></div>
                                <p id="p-bsbar"></p>
                            </div>

                        </div>
                    </div>
                    <br />
                    <div class="xl:w-1/1 w-full charts">
                        <div class="bg-white dark:bg-[#1b1b1b]" style="padding:5px">

                            <div class="overflow-x-auto table-scroll">
                                <div id="HYCheckBSPie"></div>
                            </div>

                        </div>
                    </div>
                    <br />
                    <div class="xl:w-1/1 w-full charts">
                        <div class="bg-white dark:bg-[#1b1b1b]" style="padding:5px">

                            <div class="overflow-x-auto table-scroll">
                                <div id="HYMedicationBSPie"></div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

@section Scripts
{
    @Scripts.Render("~/bundles/jqueryval")

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="~/Scripts/JS/Master.js"></script>

    <link href="~/Content/assets/css/Accordioncss.css" rel="stylesheet" />

    <script>
        var startDate = "", endDate = "";
        $(function () {
            $("table").attr("width", "100%");
        });
        $(document).ready(function () {
            BindBlock("BlockId", '@Convert.ToInt16(NCDNewMIS.Models.Enums.Default1stValue.BlockId)', '1');


            //$('select[name="BlockId"]').find('option').eq(2).attr("selected", true).change();

            //$.ajax({
            //    method: 'POST',
            //    url: document.baseURI + '/Home/GetFollowupDataSummmary',
            //    data: { 'DateRange': $('#reportrange').val() },
            //    contentType: "application/json; charset=utf-8",
            //    dataType: "json",
            //    success: onsucess,
            //    error: onerror
            //});
            ////

            var start = moment().startOf('year');//moment().subtract(29, 'days');
            var end = moment().endOf('year');//moment();
            startDate = start.format('YYYY-MM-DD');
            endDate = end.format('YYYY-MM-DD');

            function cb(start, end) {
                $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
                startDate = start.format('YYYY-MM-DD');
                endDate = end.format('YYYY-MM-DD');
                BindData(startDate, endDate);
            }

            $('#reportrange').daterangepicker({
                startDate: start,
                endDate: end,
                ranges: {
                    'Today': [moment(), moment()],
                    'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')],
                    'This Year': [moment().startOf('year'), moment().endOf('year')],
                    'All Time': [moment('2024-01-01'), moment()]
                }
          /*  }, cb);*/
            });

            //setTimeout(function () {
            //    if ($('#BlockId').val() != '' && $('#BlockId').val() != '0' && $('#BlockId').val() != null) {
            //        // BindSubcenter("SCId", '', "1", "1", $('#BlockId').val(), 0, 0,);
            //        //$('select[name="SCId"]').find('option').eq(2).attr("selected", true).change();
            //       // cb(start, end);
            //    }
            //}, 200);

            //$('#BlockId').change(function () {
            //    $('#spinner').show();
            //    cb(start, end);
            //});

            $("#downloadbtnrawall").on("click", function () {
                debugger;
                var StartDate = start; var EndDate = end;
                var downloadUrl = document.baseURI + 'Home/FollowUpSuspectedSummaryRawDataDownload?StartDate=' + StartDate + '&EndDate=' + EndDate;
                window.location.href = downloadUrl;
            });

            BindData(startDate, endDate);
            $("#btnsubmit").click(function (e) {
                e.preventDefault();
                BindData(startDate, endDate);
            });

        });
        function BindData(startDate, endDate) {
            debugger;
            $('#spinner').show();
            BlockId = $("#BlockId").val() == "" || $("#BlockId").val() == null ? '0' : $("#BlockId").val();
            TypeOfPatient = $("#TypeOfPatient").val() == "" || $("#TypeOfPatient").val() == null ? 0 : $("#TypeOfPatient").val();
            GenderId = $("#GenderId").val() == "" || $("#GenderId").val() == null ? '0' : $("#GenderId").val();
            Ageyrs = $("#Ageyrs").val() == "" || $("#Ageyrs").val() == null ? '0' : $("#Ageyrs").val();
            console.log(startDate); console.log(endDate);

            $.ajax({
                method: 'POST',
                url: document.baseURI + '/Home/GetFollowupDataSummmary',
                data: JSON.stringify({ 'BlockId': BlockId, 'StartDate': startDate, 'EndDate': endDate, 'TypeOfPatient': TypeOfPatient, 'GenderId': GenderId, 'Ageyrs': Ageyrs }), // Convert data to JSON string
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: true,
                success: onsucess,
                error: onerror
            });

        }

        function onsucess(resp) {
            debugger;
            $('#spinner').hide();
            var categories = []; var dataS = []; var dataSplinePresent = []; GandTotal = 0;
            if (resp.IsSuccess) {


                var DataList = JSON.parse(resp.Data);
                var Table1Total = (DataList.Table);
                var Table2 = (DataList.Table1);
                var Table3 = (DataList.Table2);
                var Table4 = (DataList.Table3);
                var Table5 = (DataList.Table4);
                var Table6 = (DataList.Table5);
                var Table7 = (DataList.Table6);

                var Table8Basic = (DataList.Table7);//Basic Total

                if (Table1Total != null) {
                    $('#TotalFollowupHP').html(format(Table1Total[0].TotalFollowupHP));
                    $('#TotalSuspectedVisitHP').html(format(Table1Total[0].TotalSuspectedVisitHP));
                    $('#TotalFollowupHPPercentage').html(format(Table1Total[0].TotalFollowupHPPercentage));

                    $('#TotalFollowupBS').html(format(Table1Total[0].TotalFollowupBS));
                    $('#TotalSuspectedVisitBS').html(format(Table1Total[0].TotalSuspectedVisitBS));
                    $('#TotalFollowupBSPercentage').html(format(Table1Total[0].TotalFollowupBSPercentage));

                    $('#TotalFollowupCOM').html(format(Table1Total[0].TotalFollowupCOM));
                    $('#TotalSuspectedVisitCOMorb').html(format(Table1Total[0].TotalSuspectedVisitCOMorb));
                    $('#TotalFollowupCOMPercentage').html(format(Table1Total[0].TotalFollowupCOMPercentage));

                }
                if (Table2 != null) {
                    var strp = '';
                    for (var i = 0; i < Table2.length; i++) {
                        categories.push(Table2[i].ShortLabel);
                        dataS.push({ lblname: Table2[i].Label, y: Table2[i].NoofPlaceofvisitBP, percentage: Table2[i].Percentage });
                        dataSplinePresent.push(Table2[i].Percentage);
                        strp += strp == '' ? Table2[i].Label + ' (' + Table2[i].ShortLabel + ')' : ' , ' + Table2[i].Label + ' (' + Table2[i].ShortLabel + ')';
                    }
                    $('#p-bpbar').html(strp);
                    BindBar('HYPlaceVisitBPBar', categories, dataS, dataSplinePresent, 'Place of visit: Hypertensive Suspects', "#F06F6A", "#9f3575");
                }
                if (Table3 != null) {
                    categories = []; dataS = []; dataSplinePresent = []; GandTotal = 0;
                    for (var i = 0; i < Table3.length; i++) {
                        GandTotal += Table3[i].TestingresultBP;
                        categories.push(Table3[i].Label);
                        dataS.push({ name: Table3[i].Label, d: format(Table3[i].TestingresultBP), y: Table3[i].Percentage });
                        dataSplinePresent.push(Table3[i].Percentage);
                    }
                    BindPie('HYCheckBPPie', categories, dataS, dataSplinePresent, 'Testing result: Hypertensive Suspects', 'Testing result', '<b> Toal no. of Suspects visited Health Facility: ' + format(GandTotal) + '</b>');

                }
                if (Table4 != null) {
                    categories = []; dataS = []; dataSplinePresent = []; GandTotal = 0;
                    for (var i = 0; i < Table4.length; i++) {
                        GandTotal += Table4[i].MedicationBP;
                        categories.push(Table4[i].Label);
                        dataS.push({ name: Table4[i].Label, d: format(Table4[i].MedicationBP), y: Table4[i].Percentage });
                        dataSplinePresent.push(Table4[i].Percentage);
                    }
                    BindPie('HYMedicationBPPie', categories, dataS, dataSplinePresent, 'Medication status: Hypertensive Suspects', 'Medication status', '<b> Total no. of Patients: ' + format(GandTotal) + '</b>');
                }
                //Started FOR Diabetic suspects
                if (Table5 != null) {
                    categories = []; dataS = []; dataSplinePresent = [];
                    var strp = '';
                    for (var i = 0; i < Table5.length; i++) {
                        categories.push(Table5[i].ShortLabel);
                        // dataS.push(Table5[i].NoofPlaceofvisitBS);
                        dataS.push({ lblname: Table5[i].Label, y: Table5[i].NoofPlaceofvisitBS, percentage: Table5[i].Percentage });
                        dataSplinePresent.push(Table5[i].Percentage);
                        strp += strp == '' ? Table5[i].Label + ' (' + Table5[i].ShortLabel + ')' : ' , ' + Table5[i].Label + ' (' + Table5[i].ShortLabel + ')';
                    }
                    $('#p-bsbar').html(strp);
                    BindBar('HYPlaceVisitBSBar', categories, dataS, dataSplinePresent, 'Place of visit: Diabetic suspects', "#eb9532", '#9746af');
                }
                if (Table6 != null) {
                    categories = []; dataS = []; dataSplinePresent = []; GandTotal = 0;
                    for (var i = 0; i < Table6.length; i++) {
                        GandTotal += Table6[i].TestingresultBS;
                        categories.push(Table6[i].Label);
                        dataS.push({ name: Table6[i].Label, d: format(Table6[i].TestingresultBS), y: Table6[i].Percentage });
                        dataSplinePresent.push(Table6[i].Percentage);
                    }
                    BindPie('HYCheckBSPie', categories, dataS, dataSplinePresent, 'Testing result: Diabetic suspects', 'Testing result', '<b> Toal no. of Suspects visited Health Facility: ' + format(GandTotal) + '</b>', ['#da5c2d', '#DDDF00', '#2f628a', '#24CBE5', '#914518', '#489631']);
                }
                if (Table7 != null) {
                    categories = []; dataS = []; dataSplinePresent = []; GandTotal = 0;
                    for (var i = 0; i < Table7.length; i++) {
                        GandTotal += Table7[i].MedicationBS;
                        categories.push(Table7[i].Label);
                        dataS.push({ name: Table7[i].Label, d: format(Table7[i].MedicationBS), y: Table7[i].Percentage });
                        dataSplinePresent.push(Table7[i].Percentage);
                    }
                    BindPie('HYMedicationBSPie', categories, dataS, dataSplinePresent, 'Medication status: Diabetic suspects', 'Medication status', '<b> Total no. of Patients: ' + format(GandTotal) + '</b>');
                }

                //Basic Total
                if (Table8Basic != null && Table8Basic != undefined) {
                    $('#TotalNooofScreening').html(Table8Basic[0].TotalNooofScreening);
                    $('#TotalNoofSuspectBPYes').html(Table8Basic[0].TotalNoofSuspectBPYes);
                    $('#TotalNoofSuspectBSYes').html(Table8Basic[0].TotalNoofSuspectBSYes);
                    $('#ComBothTotalNoofSuspectBPBS').html(Table8Basic[0].ComBothTotalNoofSuspectBPBS);

                    //Follow-up - BP
                    $('#NotfupNoofMembersBPYes').html(Table8Basic[0].NotfupNoofMembersBPYes);
                    $('#TotalnooffupNCDMitraYesNoBP').html(Table8Basic[0].TotalnooffupNCDMitraYesNoBP);
                    $('#TotalnooffupNCDMitraYesBP').html(Table8Basic[0].TotalnooffupNCDMitraYesBP);
                    $('#TotalNotnooffupNCDMitraYesNotBP').html(Table8Basic[0].TotalNotnooffupNCDMitraYesNotBP);
                    //Follow-up - BS
                    $('#NotfupNotNoofMembersBSYes').html(Table8Basic[0].NotfupNotNoofMembersBSYes);
                    $('#TotalnoofNCDMitraBS').html(Table8Basic[0].TotalnoofNCDMitraBS);
                    $('#TotalnoofNCDMitraYesBS').html(Table8Basic[0].TotalnoofNCDMitraYesBS);
                    $('#TotalNotnoofNCDMitraYesNoBS').html(Table8Basic[0].TotalNotnoofNCDMitraYesNoBS);


                }
            }
            else {
                toastr.error("Error", resp.Data);
               // alert("Oops!! Something went Wrong..Please Try Again.");
            }
        }
        function onerror(resp) {
            $('#spinner').hide();
            toastr.error("Error", resp.Data);//resp.Data
            alert("Oops!! Something went Wrong..Please Try Again.");
        }
        function format(n) {
            n = n.toString()
            while (true) {
                var n2 = n.replace(/(\d)(\d{3})($|,|\.)/g, '$1,$2$3')
                if (n == n2) break
                n = n2
            }
            return n
        }
        function BindBar(DivId, categories, dataS, dataSplinePresent, Title, Color, Color1) {
            Highcharts.chart(DivId, {
                chart: {
                    height: 400,
                    zooming: {
                        type: 'xy',
                        size: 200
                    }
                },
                title: {
                    text: '<b>' + Title + '</b>',
                    align: 'left',
                    style: {
                        color: '#c57e31',
                        font: 'bold 16px "Trebuchet MS", Verdana, sans-serif',
                        textdecoration: 'underline',
                    },
                },
                //subtitle: {
                //    text: '',
                //    align: 'left'
                //},
                credits: {
                    enabled: false,
                },
                xAxis: [{
                    categories: categories,
                    crosshair: true,
                    //labels: {
                    //    //rotation: 10,
                    //    //align: 'right',
                    //   // step: 10,
                    //    // enabled: true

                    //},
                    //tickColor: '#FF0000',
                    //tickWidth: 3,
                    style: {
                        fontSize: '8px'
                    },
                }],
                yAxis: [{ // Primary yAxis
                    labels: {
                        enabled: false,
                        //format: '{value}°C',
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        },
                    },
                    title: {
                        enabled: false,
                        //text: 'Temperature',
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        }
                    }
                }, { // Secondary yAxis
                    title: {
                        enabled: false,
                        //text: 'Precipitation',
                        style: {
                            color: Highcharts.getOptions().colors[0]
                        }
                    },
                    labels: {
                        enabled: false,
                        //format: '{value} mm',
                        style: {
                            color: Highcharts.getOptions().colors[0]
                        }
                    },
                    opposite: true,
                    gridLineColor: 'transparent',
                }],
                //yAxis: {
                //    title: false
                //},
                //tooltip: {
                //    shared: true
                //},
                tooltip: {
                    formatter: function () {
                        //return 'Place of visit : </ br>' + this.lblname +' : '+ this.y + ' ( ' + this.percentage + ' % )';
                        return '' + this.lblname +' : '+ this.y + ' ( ' + this.percentage + ' % )';
                    }
                },
                plotOptions: {
                   
                    series: {
                        //dataLabels: {
                        //    enabled: true
                        //}
                        dataLabels: {
                            enabled: true,
                            borderRadius: 5,
                            backgroundColor: 'rgba(252, 255, 197, 0.7)',
                            borderWidth: 1,
                            borderColor: '#AAA',
                            y: -6,
                            formatter: function () {
                                //debugger
                                return  this.percentage + ' %';
                            }
                        }
                    }
                    //series: {
                    //    dataLabels: {
                    //        enabled: true,
                    //        align: 'right',
                    //        color: '#FFFFFF',
                    //        x: -10
                    //    },
                    //    pointPadding: 0.2,
                    //    groupPadding: 0
                    //}
                },
                legend: {
                    align: 'left',
                    x: 80,
                    verticalAlign: 'top',
                    y: 60,
                    floating: true,
                    backgroundColor:
                        Highcharts.defaultOptions.legend.backgroundColor || // theme
                        'rgba(255,255,255,0.25)'
                },
                series: [{
                    name: 'Place of visit',
                    type: 'column',
                    yAxis: 1,
                    data: dataS,
                    color: Color
                    //tooltip: {
                    //    valueSuffix: ' mm'
                    //}

                }
                    //, {
                    //name: 'Place of visit %',
                    //type: 'spline',
                    //data: dataSplinePresent,
                    //color: Color1

                    ////tooltip: {
                    ////    valueSuffix: '°C'
                    ////}
                    //}
                ]
            });
        }
        Highcharts.setOptions({
            lang: {
                thousandsSep: ','
            }
        });
        Highcharts.setOptions({
            colors: ['#da5c2d', '#DDDF00', '#2f628a', '#24CBE5', '#914518', '#489631']
            // colors: ['#489631', '#ED561B', '#DDDF00', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4']
        });
        function BindPie(DivId, categories, dataS, dataSplinePresent, Title, NM, GandTotal, colorarry) {
            Highcharts.chart(DivId, {
                chart: {
                    type: 'pie'
                },
                title: {
                    text: '<b>' + Title + '</b>',
                    align: 'left',
                    style: {
                        color: '#c57e31',
                        font: 'bold 16px "Trebuchet MS", Verdana, sans-serif',
                        textdecoration: 'underline',
                    },
                },
                subtitle: {
                    text: '<b>' + GandTotal + '</b>',
                    align: 'left',
                    verticalAlign: 'bottom',
                    style: {
                        color: '#262a58',
                        //font: 'bold 12px "Trebuchet MS", Verdana, sans-serif'
                    },
                },
                credits: {
                    enabled: false,
                },
                accessibility: {
                    announceNewData: {
                        enabled: true
                    },
                    point: {
                        valueSuffix: '%'
                    }
                },

                plotOptions: {
                    pie: {
                        size: 200
                    },
                    series: {
                        borderRadius: 5,
                        dataLabels: [{
                            enabled: true,
                            distance: 15,
                            format: '{point.name}'
                        }, {
                            enabled: true,
                            distance: '-30%',
                            filter: {
                                property: 'percentage',
                                operator: '>',
                                value: 5
                            },
                            format: '{point.y:.1f}%',
                            style: {
                                fontSize: '0.9em',
                                textOutline: 'none'
                            }
                        }]
                    }
                },

                tooltip: {
                    headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                    pointFormat: '<span style="color:{point.color}">{point.name}</span>: ' +
                        '<b>{point.d} | {point.y:.2f}%</b> of total<br/>'
                },

                series: [
                    {
                        name: NM,
                        colorByPoint: true,
                        data: dataS,
                        color: colorarry

                    }
                ],

            });
        }


        $(document).ajaxSend(function () {
            $('#spinner').show();
        });

        $(document).ajaxComplete(function () {
            $('#spinner').hide();
        });
    </script>
}
